<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Start VWO SmartCode -->
    <script>
      // Get VWO ID from URL parameter or use default
      const urlParams = new URLSearchParams(window.location.search);
      const vwoId = urlParams.get("id") || "1120758";

      // Create VWO script element with dynamic ID
      const vwoScript = document.createElement("script");
      vwoScript.referrerPolicy = "no-referrer-when-downgrade";
      vwoScript.src = `https://dev.visualwebsiteoptimizer.com/lib/${vwoId}.js`;
      vwoScript.id = "vwoCode";
      document.head.appendChild(vwoScript);

      console.log("VWO loaded with ID:", vwoId);
    </script>
    <!-- End VWO SmartCode -->

    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SPA Demo - TechFlow</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: Arial, sans-serif;
        line-height: 1.6;
        color: #333;
        background: #f8f9fa;
      }

      .container {
        max-width: 1000px;
        margin: 0 auto;
        padding: 20px;
      }

      .header {
        background: #343a40;
        color: white;
        padding: 1rem 0;
        margin-bottom: 2rem;
        border-radius: 8px;
      }

      .nav {
        display: flex;
        justify-content: space-between;
        align-items: center;
        max-width: 1000px;
        margin: 0 auto;
        padding: 0 20px;
      }

      .nav a {
        color: white;
        text-decoration: none;
        margin: 0 10px;
        padding: 8px 15px;
        border-radius: 4px;
      }

      .nav a:hover {
        background: rgba(255, 255, 255, 0.2);
      }

      .card {
        background: white;
        padding: 2rem;
        margin: 1rem 0;
        border-radius: 8px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        border-left: 4px solid #007bff;
      }

      .btn {
        background: #007bff;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        margin: 5px;
        text-decoration: none;
        display: inline-block;
        transition: background 0.3s;
      }

      .btn:hover {
        background: #0056b3;
      }

      .btn-success {
        background: #28a745;
      }

      .btn-success:hover {
        background: #1e7e34;
      }

      .btn-warning {
        background: #ffc107;
        color: #212529;
      }

      .btn-warning:hover {
        background: #e0a800;
      }

      .btn-danger {
        background: #dc3545;
      }

      .btn-danger:hover {
        background: #c82333;
      }

      .url-display {
        background: #e9ecef;
        padding: 15px;
        border-radius: 4px;
        font-family: monospace;
        margin: 10px 0;
        border: 1px solid #ced4da;
      }

      .counter-display {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin: 20px 0;
      }

      .counter-item {
        background: #f8f9fa;
        padding: 20px;
        text-align: center;
        border-radius: 8px;
        border: 2px solid #dee2e6;
      }

      .counter-item h3 {
        margin-bottom: 10px;
        color: #495057;
      }

      .counter-value {
        font-size: 2rem;
        font-weight: bold;
        color: #007bff;
      }

      .form-inline {
        display: flex;
        gap: 10px;
        align-items: center;
        flex-wrap: wrap;
      }

      .form-inline input {
        padding: 8px 12px;
        border: 1px solid #ced4da;
        border-radius: 4px;
      }

      .history-list {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 4px;
        max-height: 200px;
        overflow-y: auto;
      }

      .history-item {
        padding: 5px 0;
        border-bottom: 1px solid #dee2e6;
        font-family: monospace;
        font-size: 0.9rem;
      }

      .current-params {
        background: #d4edda;
        border: 1px solid #c3e6cb;
        padding: 15px;
        border-radius: 4px;
        margin: 15px 0;
      }

      .param-item {
        display: flex;
        justify-content: space-between;
        margin: 5px 0;
      }

      .param-key {
        font-weight: bold;
        color: #155724;
      }

      .param-value {
        color: #0c5460;
        font-family: monospace;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header class="header">
        <nav class="nav">
          <div>
            <strong>TechFlow - SPA Demo</strong>
          </div>
          <div>
            <a href="index.html">Home</a>
            <a href="page1.html">Page 1</a>
            <a href="page2.html">Page 2</a>
            <a href="spa.html">SPA Demo</a>
          </div>
        </nav>
      </header>

      <div class="card">
        <h1>Single Page Application Demo</h1>
        <p>
          This page demonstrates URL manipulation and query parameter tracking
          for A/B testing purposes.
        </p>

        <div class="url-display" id="currentUrl">
          Current URL: <span id="urlText">Loading...</span>
        </div>
      </div>

      <div class="card">
        <h2>URL Parameter Controls</h2>
        <p>
          Click buttons to modify URL parameters and track user interactions:
        </p>

        <div style="margin: 20px 0">
          <button class="btn" onclick="incrementParam('clicks')">
            Increment Clicks (clicks=<span id="clicksValue">0</span>)
          </button>

          <button class="btn btn-success" onclick="incrementParam('actions')">
            Increment Actions (actions=<span id="actionsValue">0</span>)
          </button>

          <button class="btn btn-warning" onclick="incrementParam('views')">
            Increment Views (views=<span id="viewsValue">0</span>)
          </button>

          <button class="btn btn-danger" onclick="resetParam('clicks')">
            Reset Clicks
          </button>
        </div>

        <div class="form-inline">
          <input type="text" id="customParam" placeholder="Parameter name" />
          <input type="text" id="customValue" placeholder="Parameter value" />
          <button class="btn" onclick="setCustomParam()">
            Set Custom Param
          </button>
          <button class="btn btn-warning" onclick="clearAllParams()">
            Clear All
          </button>
        </div>
      </div>

      <div class="counter-display">
        <div class="counter-item">
          <h3>Total Clicks</h3>
          <div class="counter-value" id="totalClicks">0</div>
        </div>
        <div class="counter-item">
          <h3>URL Changes</h3>
          <div class="counter-value" id="urlChanges">0</div>
        </div>
        <div class="counter-item">
          <h3>Parameters Set</h3>
          <div class="counter-value" id="parametersSet">0</div>
        </div>
        <div class="counter-item">
          <h3>Session Time</h3>
          <div class="counter-value" id="sessionTime">00:00</div>
        </div>
      </div>

      <div class="card">
        <h2>Current Parameters</h2>
        <div class="current-params" id="currentParams">
          <p><em>No parameters set</em></p>
        </div>
      </div>

      <div class="card">
        <h2>Navigation History</h2>
        <div class="history-list" id="historyList">
          <div class="history-item">Session started</div>
        </div>
        <button class="btn btn-warning" onclick="clearHistory()">
          Clear History
        </button>
      </div>

      <div class="card">
        <h2>A/B Testing Scenarios</h2>
        <p>Test different user journey scenarios:</p>

        <button class="btn" onclick="simulateScenario('signup')">
          Simulate Signup Flow
        </button>

        <button class="btn" onclick="simulateScenario('purchase')">
          Simulate Purchase Flow
        </button>

        <button class="btn" onclick="simulateScenario('engagement')">
          Simulate Engagement Flow
        </button>

        <button
          class="btn btn-success"
          onclick="simulateScenario('conversion')"
        >
          Simulate Conversion
        </button>
      </div>
    </div>

    <script>
      let urlChangeCount = 0;
      let totalClickCount = 0;
      let parametersSetCount = 0;
      let startTime = Date.now();
      let history = [];

      // Initialize page
      document.addEventListener("DOMContentLoaded", function () {
        updateDisplay();
        startSessionTimer();
        addToHistory("Page loaded");
      });

      // Get URL parameters
      function getUrlParams() {
        const params = new URLSearchParams(window.location.search);
        const result = {};
        for (let [key, value] of params) {
          result[key] = value;
        }
        return result;
      }

      // Update URL with new parameter
      function updateUrlParam(key, value) {
        const url = new URL(window.location);

        if (value === null || value === "" || value === "0") {
          url.searchParams.delete(key);
        } else {
          url.searchParams.set(key, value);
        }

        window.history.pushState({}, "", url);
        urlChangeCount++;
        updateDisplay();
        addToHistory(`Set ${key}=${value}`);

        // Track for A/B testing
        if (window.ABTest) {
          window.ABTest.trackConversion(`spa_param_${key}`);
        }
      }

      // Increment a parameter value
      function incrementParam(paramName) {
        const currentParams = getUrlParams();
        const currentValue = parseInt(currentParams[paramName] || "0");
        const newValue = currentValue + 1;

        updateUrlParam(paramName, newValue.toString());
        totalClickCount++;
        parametersSetCount++;

        // Update individual counter displays
        document.getElementById(paramName + "Value").textContent = newValue;

        console.log(`${paramName} incremented to ${newValue}`);
      }

      // Reset a parameter
      function resetParam(paramName) {
        updateUrlParam(paramName, null);
        document.getElementById(paramName + "Value").textContent = "0";
        addToHistory(`Reset ${paramName}`);
      }

      // Set custom parameter
      function setCustomParam() {
        const paramName = document.getElementById("customParam").value;
        const paramValue = document.getElementById("customValue").value;

        if (paramName && paramValue) {
          updateUrlParam(paramName, paramValue);
          parametersSetCount++;

          // Clear inputs
          document.getElementById("customParam").value = "";
          document.getElementById("customValue").value = "";
        } else {
          alert("Please enter both parameter name and value");
        }
      }

      // Clear all parameters
      function clearAllParams() {
        const url = new URL(window.location);
        url.search = "";
        window.history.pushState({}, "", url);

        urlChangeCount++;
        updateDisplay();
        addToHistory("Cleared all parameters");

        // Reset all displayed values
        document.getElementById("clicksValue").textContent = "0";
        document.getElementById("actionsValue").textContent = "0";
        document.getElementById("viewsValue").textContent = "0";
      }

      // Update all displays
      function updateDisplay() {
        // Update URL display
        document.getElementById("urlText").textContent = window.location.href;

        // Update counters
        document.getElementById("totalClicks").textContent = totalClickCount;
        document.getElementById("urlChanges").textContent = urlChangeCount;
        document.getElementById("parametersSet").textContent =
          parametersSetCount;

        // Update current parameters display
        updateCurrentParams();
      }

      // Update current parameters display
      function updateCurrentParams() {
        const params = getUrlParams();
        const container = document.getElementById("currentParams");

        if (Object.keys(params).length === 0) {
          container.innerHTML = "<p><em>No parameters set</em></p>";
        } else {
          let html = "";
          for (let [key, value] of Object.entries(params)) {
            html += `
              <div class="param-item">
                <span class="param-key">${key}:</span>
                <span class="param-value">${value}</span>
              </div>
            `;
          }
          container.innerHTML = html;
        }
      }

      // Add to history
      function addToHistory(action) {
        const timestamp = new Date().toLocaleTimeString();
        history.push(`${timestamp}: ${action}`);

        const historyContainer = document.getElementById("historyList");
        const historyItem = document.createElement("div");
        historyItem.className = "history-item";
        historyItem.textContent = `${timestamp}: ${action}`;
        historyContainer.appendChild(historyItem);

        // Scroll to bottom
        historyContainer.scrollTop = historyContainer.scrollHeight;
      }

      // Clear history
      function clearHistory() {
        history = [];
        const historyContainer = document.getElementById("historyList");
        historyContainer.innerHTML =
          '<div class="history-item">History cleared</div>';
      }

      // Session timer
      function startSessionTimer() {
        setInterval(() => {
          const elapsed = Math.floor((Date.now() - startTime) / 1000);
          const minutes = Math.floor(elapsed / 60)
            .toString()
            .padStart(2, "0");
          const seconds = (elapsed % 60).toString().padStart(2, "0");
          document.getElementById(
            "sessionTime"
          ).textContent = `${minutes}:${seconds}`;
        }, 1000);
      }

      // Simulate different scenarios
      function simulateScenario(scenarioType) {
        addToHistory(`Started ${scenarioType} scenario`);

        switch (scenarioType) {
          case "signup":
            updateUrlParam("step", "1");
            setTimeout(() => updateUrlParam("step", "2"), 1000);
            setTimeout(() => updateUrlParam("step", "3"), 2000);
            setTimeout(() => {
              updateUrlParam("step", null);
              updateUrlParam("signup", "complete");
              addToHistory("Signup scenario completed");
            }, 3000);
            break;

          case "purchase":
            updateUrlParam("cart", "1");
            setTimeout(() => updateUrlParam("cart", "2"), 1000);
            setTimeout(() => updateUrlParam("checkout", "true"), 2000);
            setTimeout(() => {
              updateUrlParam("cart", null);
              updateUrlParam("checkout", null);
              updateUrlParam("purchase", "success");
              addToHistory("Purchase scenario completed");
            }, 3000);
            break;

          case "engagement":
            updateUrlParam("page_views", "1");
            setTimeout(() => incrementParam("page_views"), 1000);
            setTimeout(() => incrementParam("page_views"), 2000);
            setTimeout(() => {
              updateUrlParam("engaged", "true");
              addToHistory("Engagement scenario completed");
            }, 3000);
            break;

          case "conversion":
            updateUrlParam("funnel", "entry");
            setTimeout(() => updateUrlParam("funnel", "interest"), 1000);
            setTimeout(() => updateUrlParam("funnel", "consideration"), 2000);
            setTimeout(() => {
              updateUrlParam("funnel", null);
              updateUrlParam("converted", "true");
              addToHistory("Conversion scenario completed");

              // Track conversion for A/B testing
              if (window.ABTest) {
                window.ABTest.trackConversion("spa_conversion_complete");
              }
            }, 3000);
            break;
        }

        totalClickCount++;
        parametersSetCount += 3;
      }

      // Simple A/B testing utilities
      window.ABTest = {
        trackConversion: function (event) {
          console.log("Conversion tracked:", event);
          addToHistory(`Tracked: ${event}`);
          // This would integrate with your actual analytics
        },
      };

      // Handle browser back/forward buttons
      window.addEventListener("popstate", function (event) {
        updateDisplay();
        addToHistory("Navigation via browser buttons");
      });

      // Initialize parameter displays from URL on load
      window.addEventListener("load", function () {
        const params = getUrlParams();
        if (params.clicks)
          document.getElementById("clicksValue").textContent = params.clicks;
        if (params.actions)
          document.getElementById("actionsValue").textContent = params.actions;
        if (params.views)
          document.getElementById("viewsValue").textContent = params.views;
      });
    </script>
  </body>
</html>
